\documentclass[a4paper,11pt]{report}

\usepackage{fullpage}
\usepackage{amsmath}
\usepackage{bussproofs}
\usepackage{color}
\usepackage{hyperref}
\usepackage{placeins}
\usepackage{csquotes}

\usepackage{etoolbox}
\usepackage{sourcecodepro}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}

\usepackage[
backend=biber,
style=alphabetic,
sortlocale=en_GB,
natbib=true,
url=false,
doi=true,
eprint=false,
citestyle=alphabetic-verb
]{biblatex}


% % Page style
% \usepackage{fancyhdr}
  
% \setlength{\headheight}{17pt}
% \pagestyle{fancy}

% % Standard pages (inside chapters)
% \fancyhf{}
% \renewcommand{\headrulewidth}{0.4pt}
% \renewcommand{\footrulewidth}{0pt}
% \fancyheadoffset{0cm}

% \fancyhead[OR]{\bfseries \nouppercase{\rightmark}}
% \fancyhead[EL]{\bfseries \nouppercase{\leftmark}}
% \fancyfoot[EL,OR]{\thepage}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Minted
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[cache=false]{minted}
\usemintedstyle{tango}

%%%%%%%%%% C
\newmintinline{c}{
  fontsize=\small,
  breaklines=true
}

\newminted{c}{
  frame=single,
  framesep=2mm,
  fontsize=\scriptsize,
  mathescape
}

\newminted[ccodeline]{c}{
  frame=single,
  framesep=2mm,
  fontsize=\scriptsize,
  mathescape,
  linenos
}


%%%%%%%%% CMAKE
\newminted{cmake}{
  frame=single,
  framesep=2mm,
  fontsize=\scriptsize,
  mathescape,
  linenos,
  breaklines=true
}

% End minted
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\setlength{\parindent}{0pt}

\bibliography{bibliography.bib}

\begin{document}

\begin{center}
  \Large{
    Operating Systems\\
    Spring 2018
  }
  
  \noindent\makebox[\linewidth]{\rule{\linewidth}{0.4pt}}
  Operating Systems Project
  \noindent\makebox[\linewidth]{\rule{\linewidth}{0.4pt}}

  \begin{flushleft}
    Professor : Philippe Cudr√©-Mauroux

    Assistant : Ines Arous
  \end{flushleft}
  
  \noindent\makebox[\linewidth]{\rule{\linewidth}{0.4pt}}

  Submitted by Groupe 4: Sylvain Julmy, Michael Papinutto, Sami Veillard
  
  \noindent\makebox[\linewidth]{\rule{\textwidth}{1pt}}
  \vspace*{0.8cm}
  \today

\end{center}

\newpage

\section*{Introduction}
For this project, we had to implement a multi-threaded client-server system using TCP sockets.
This system had abilities to write keys with values, read values providing a key, simultaneous safe access of the readers and the writers.
This system was subsequently tested using an automated testing in form of a bash script.

\section*{Choosen approach}

We have to take care of various aspect when choosing the data structure to
store the key-value entry : maximal number of entry stored in the database,
extension of the data structure, number of simultaneous access on the server and
how to synchronize the threads.

A lock-free hashset data structure offers solutions to all of those challenges.
We have implements our own data structure in C based on the one created by
Herliry in \cite{Herlihy2006} in Java.

\section*{Challenges encountered}
One of the challenge we encountered was to read or deleted entries from values.
Indeed, looking for a value in a hashtable is not as straight forward as it seems to.
It required to navigate through all the keys until finding the corresponding value.
Despite the high cost of this operation, we decided to use this method as we did not find any other way top provide such an operation.

\section*{Conclusion}

\printbibliography

\section*{Documentation}

\subsection*{Communication}
The server and the clients communicate through socket.

\subsection*{Server}
The server is composed of several binary files.
The main file encompasses the socket setup for the server and dedicated files for communication and the shell graphical user interface.
The server is multi-threaded, \textit{i.e.}, after each connection of a client the server create a new thread.
The data structure is described above.

\subsection*{Server usage}

\begin{tabular}{l|c|r}
\hline
TCP Port & 5000 (can be reset in the server main file) \\
\hline
.\server & server start
\hline
\end{tabular}

\subsection*{Client}
The client is also composed from several binary files.
The main file set up client socket and dedicated files are used for execution of command and shell graphical interface.
On the contrary of the server shell, the client shell is an interactive shell which usage is described below.
Moreover, to simplify benchmark the client can also accept files at launch.

\subsection*{Client usage}

\begin{tabular}{l|c|r}
\hline
.\client <server ip address> & client start
\hline
.\client -option <server ip address> & client start with options (see below)
\hline
\end{tabular}

\begin{tabular}{l|c|r}
\hline
\multicolumn{3}{Option at client start (optionnal)}
\hline
-?, -h or --help & client command help
\hline
-f <file> or --file <file> & client start and execute command present in the file specified after this option
\hline
-F <file1> ... <fileN> or --files <file1> ... <fileN> & client start and execute command present in the files specified after this option
\hline

\begin{tabular}{l|c|r}
\hline
\multicolumn{3}{Command usage after client start}
\hline
add <value> or add <key> <value> & add a value to the database with or without generated key
\hline
ls & list the content of the database (unordered)
\hline
read_v <key> & read a value in the database from a key
\hline
read_k <value> & read a key in the database from a value
\hline
rm_v <key> & delete a value in the database from a key
\hline
rm_k <value> & delete a value in the database from a key
\hline
update_kv <value> <newvalue> & update an entry in the database
\hline
\end{tabular}
\end{document}

